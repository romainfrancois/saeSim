<!--
%\VignetteEngine{knitr::knitr}
%\VignetteIndexEntry{Introduction}
-->
```{r include=FALSE}
options(markdown.HTML.header = system.file('misc', 'vignette.css', package='knitr'))
```

# Semi-custom data

Data is generated by combining two aspects. First it must be specified how data adds to the model, then it needs to be specified what data it is. There are two ways to specify how data adds to the model, as a fixed or random component. You can use the following functions for that:

- `sim_gen_fe(generator, const = 0, slope = 1, name = "x")` - adding as fixed effects
- `sim_gen_e(generator, name = "e")` - adding as error
- `sim_gen_re(generator, name = "v")` - this a wrapper of `sim_gen_e` providing different defaults

What data is added can be specified for given generators:

- `gen_norm(mean = 0, sd = 1)` - normally distributed variable
- `gen_v_norm(mean = 0, sd = 1)` - normally distributed variable but constant within domain
- `gen_v_sar(mean = 0, sd = 1, rho = 0.5, type = "rook")` - normally distributed variable following a SAR(1), constant within domain

Meaning we can specify a linear mixed model set-up with the regressor `x`, the model error `e` a random effect `v` and a spatially correlated random effect `vSp` as follows:

```{r}
library(saeSim)
setup <- sim_base() %>% sim_gen_fe() %>% sim_gen_e() %>% sim_gen_re() %>% sim_gen_re(gen_v_sar(name = "vSp"))
# This will result in the same set-up:
setup <- sim_base_lmm() %>% sim_gen_re(gen_v_sar(name = "vSp"))
```

To get the simulated data as a list (when given to the function `sim` it creates 500 Populations):

```{r eval=FALSE}
dataList <- sim(setup)
```

# Contaminated data

When interested in contamination it is important to know, that the contamination adds additively to the values in the data. This means how data is added to the model changes, the data generators stay the same. If you want a contaminated spatially correlated error component you can add the following to the `setup` object from above:

```{r}
contSetup <- setup %>% 
  sim_gen_rec(gen_v_sar(sd = 40, name = "vSp"), nCont = 0.05, level = "area", fixed = TRUE)
```

Note that the generator is the same but with a higher standard deviation. There are two functions for adding contaminated components:

- `sim_gen_ec(generator, nCont = 0.05, level = "unit", fixed = TRUE, name = "e")` - set-up function for a contaminated model error part
- `sim_gen_rec()` - wrapper function of `sim_gen_ec` with different defaults

The 'rec' and 'ec' functions will do the same as the standard functions, however, they add only to a specified set of observations. I.e. the contamination is added additively. How and what random numbers are generated will be controlled via generator functions. The argument `nCont` controls how much observations are contaminated. Values < 1 are interpreted as proportion. A single number as the number of contaminated units (can be areas or observations in each area or observations). When given with `length(nCont) > 1` it will be interpreted as number of contaminated observations in each area. The `level` can be 'area', 'unit' or 'none'; specifying how `nCont` is interpreted. 5% of the observations, 5% of the observations in each area or 5% of the areas. If `fixed` is true in all simulations the same units will be contaminated.

If you use relative numbers for `nCont` the actual number of contaminated observations is rounded up. If the number of contaminated units is larger then the actual, all units will be contaminated.

Use the following example to see how these things play together:

```{r}
sim(base_id(3, 4) %>% sim_gen_fe() %>% sim_gen_e() %>% 
      sim_gen_ec(gen_norm(mean = 0, sd = 150, name = "eCont"), 
                 nCont = c(1, 2, 3), level = "unit"))
```

# Custom data

You just have to provide your own generator functions. I will explain how that works in time.