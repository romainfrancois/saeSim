<!--
%\VignetteEngine{knitr::knitr}
%\VignetteIndexEntry{Introduction}
-->
```{r include=FALSE}
options(markdown.HTML.header = system.file('misc', 'vignette.css', package='knitr'))
```

# Introduction

`saeSim` is a Package for the [R](http://cran.r-project.org/) language. It is developed to make the data simulation process more compact and yet flexible enough for customization. It is designed to suffice in the context of small area estimation.

# Data Set-up

Consider a linear mixed model. It contains two components. A fixed effects part, and an error component. The error component can be split into a random effects part and a model error. All components to be simulated can simply be added to data. 

- Here follows a example for a linear model:

```{r}
library(saeSim)
setup <- sim_base() %>% sim_gen_x() %>% sim_gen_e() %>% 
  sim_resp_eq(y = 100 + 2 * x + e) %>% sim_simName("Doku")
setup
```

`sim_base()` is responsible to supply a `data.frame` to which variables can be added. The default is to create a `data.frame` with indicator variables `idD` and `idU` (2-level-model), which uniquly identify observations. `sim_resp` will add a variable `y` as response.

- The set-up itself does not contain the simulated data but the functions to process the data. For starting a simulation use the function `sim`. It will return a `list` containing `data.frame`s as elements:

```{r eval=FALSE}
dataList <- sim(setup, R = 10)
```
- Lastly, it is possible to just produce one data set. This approach is mainly used in development but can be useful when exploring the set-up:
```{r eval=FALSE}
simData <- sim_base() %>% sim_gen_x() %>% sim_gen_e() %>% as.data.frame
```

## sim_base

For the simulation set-up you start with the 'base', which is just a `data.frame`. 

- `base_id(nDomains, nUnits)` - `nDomains` specify the number of domains/cluster/areas in the data - `nUnits` the number of observations in each domain.


## sim_gen

This section gives an overview of data which can be generated.

### Pre-configured set-ups

There are several pre-configured set-ups you can use for an easy start.

- `sim_base_lm()` will return a simulation set-up for a linear model, i.e. one regressor and one error component.
- `sim_base_lmm()` a linear mixed model
- `sim_base_lmc()` a linear model with contamination in the model error (5% outliers in each area)
- `sim_base_lmmc()` a linear mixed model with contamination in the model error and random effect (5% outliers in each area and 5% of the areas are outliers)


## sim_agg

If you are interested in aggregated information you can either draw directly from the model when specifying `nUnits = 1` or use the aggregate component. Aggregating the data is another component which can be used on the population or sample. The aggregation will simply be done after the sampling, if you haven't specified any sampling component, the population is aggregated (makes sense if you draw samples directly from the model).

```{r}
sim_base_lm() %>% sim_agg()
```

## Methods

You will want to check your results regularly to see how things will work out. When working with `sim_setup` objects there are some methods supplied to do that, without simulating redundant data all the time:

- `show` - this is the `print` method for S4-Classes. You don't have to call `show` explicitly
- `plot` - will call `smoothScatter` for visualizing the data
- `autoplot` - Will imitate `smoothScatter` with ggplot2

```{r}
setup <- sim_base_lmm()
plot(setup)
library(ggplot2)
autoplot(setup)
autoplot(setup, "e")
```

```{r}
autoplot(setup %>% sim_gen_vc())
```